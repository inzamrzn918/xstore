<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintShare - Shop Receiver</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="shop-info">
                <h1>üñ®Ô∏è PrintShare</h1>
                <p class="shop-name" id="shopName">Loading...</p>
            </div>
            <div class="header-actions">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span id="statusText">Ready to Receive</span>
                </div>
                <button class="btn-icon" onclick="showSettings()" title="Settings">
                    ‚öôÔ∏è
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Setup Screen (First Time) -->
            <div id="setupScreen" class="setup-screen" style="display: none;">
                <div class="setup-card">
                    <h2>üè™ Shop Setup</h2>
                    <p>Configure your print shop details</p>

                    <div class="form-group">
                        <label>Shop Name</label>
                        <input type="text" id="setupShopName" placeholder="e.g., Quick Print Services" />
                    </div>

                    <div class="form-group">
                        <label>Location (Optional)</label>
                        <input type="text" id="setupLocation" placeholder="e.g., Main Street, Downtown" />
                    </div>

                    <button class="btn btn-primary btn-large" onclick="saveShopSetup()">
                        ‚úÖ Save & Generate QR Code
                    </button>
                </div>
            </div>

            <!-- Main Screen (Chat-Style Layout) -->
            <div id="mainScreen" class="main-screen">
                <!-- Client List Panel (Left) -->
                <div class="clients-panel">
                    <div class="panel-header">
                        <h3>üì± Connected Clients</h3>
                        <span class="client-count" id="clientCount">0 online</span>
                    </div>
                    <div id="clientsList" class="clients-list">
                        <div class="empty-state">
                            <div class="empty-icon">üö´</div>
                            <p>No clients connected</p>
                            <p class="empty-subtitle">Clients will appear when they scan the QR code</p>
                        </div>
                    </div>
                </div>

                <!-- File View Panel (Right) -->
                <div class="files-panel">
                    <div class="panel-header">
                        <div class="selected-client-info">
                            <h3 id="selectedClientName">Select a client</h3>
                            <span id="selectedClientMeta" class="client-meta"></span>
                        </div>
                        <div class="header-actions">
                            <span class="file-count" id="fileCount">0 files</span>
                            <div class="client-management-btns">
                                <button class="btn btn-outline btn-sm" id="btnDisconnect"
                                    onclick="disconnectSelectedClient()" title="Disconnect Client">üîå</button>
                                <button class="btn btn-danger-outline btn-sm" id="btnBlock"
                                    onclick="blockSelectedClient()" title="Block IP">üö´</button>
                            </div>
                        </div>
                    </div>
                    <div id="filesList" class="files-list">
                        <div class="empty-state">
                            <div class="empty-icon">üìÅ</div>
                            <p>No client selected</p>
                            <p class="empty-subtitle">Select a client from the left to view their files</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Preview Modal -->
            <div id="filePreviewModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="previewFileName">File Preview</h3>
                        <button class="close-btn" onclick="closePreview()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div id="previewContent" class="preview-content">
                            <!-- Preview will be inserted here -->
                        </div>
                        <div class="preview-info">
                            <div class="info-row">
                                <span class="label">Size:</span>
                                <span id="previewSize">-</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Type:</span>
                                <span id="previewType">-</span>
                            </div>
                            <div class="info-row">
                                <span class="label">From:</span>
                                <span id="previewFrom">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closePreview()">
                            Cancel
                        </button>
                        <button class="btn btn-primary" onclick="acceptFile()">
                            ‚úÖ Accept & Save
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Modal -->
            <div id="settingsModal" class="modal" style="display: none;">
                <div class="modal-content settings-modal">
                    <div class="modal-header">
                        <h3>‚öôÔ∏è Settings</h3>
                        <button class="close-btn" onclick="closeSettings()">‚úï</button>
                    </div>
                    <div class="settings-tabs">
                        <button class="settings-tab active" onclick="switchTab('qr')">QR Code</button>
                        <button class="settings-tab" onclick="switchTab('shop')">Shop Details</button>
                        <button class="settings-tab" onclick="switchTab('general')">General</button>
                        <button class="settings-tab" onclick="switchTab('features')">Features</button>
                    </div>
                    <div class="modal-body">
                        <!-- QR Code Tab -->
                        <div id="qrTab" class="settings-tab-content active">
                            <div class="settings-section qr-settings">
                                <h4>üì± Scan to Connect</h4>
                                <div class="qr-display-settings">
                                    <div class="qr-container-settings">
                                        <canvas id="settingsQRCode"></canvas>
                                    </div>
                                    <div class="qr-info-settings">
                                        <div class="info-badge">
                                            <span class="badge-icon">üè™</span>
                                            <span id="settingsDisplayShopName">-</span>
                                        </div>
                                        <div class="info-badge">
                                            <span class="badge-icon">üåê</span>
                                            <span id="settingsDisplayShopIP">-</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="web-url-section-settings">
                                    <div class="url-label">üì± Web Client URL:</div>
                                    <div class="url-display">
                                        <a id="settingsWebClientURL" href="#" target="_blank"
                                            class="web-url">Loading...</a>
                                        <button class="btn-copy" onclick="copyWebURL()" title="Copy URL">üìã</button>
                                    </div>
                                    <p class="url-help">Scan QR or share URL for customers to send files</p>
                                </div>
                                <div class="button-group center">
                                    <button class="btn btn-secondary btn-sm" onclick="printPoster()">
                                        üñ®Ô∏è Print Shop Poster
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- General Tab -->
                        <div id="generalTab" class="settings-tab-content active">
                            <div class="settings-section">
                                <h4>üìÅ File Settings</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Maximum File Size</strong>
                                        <p>Maximum size per file (MB)</p>
                                    </div>
                                    <input type="number" id="maxFileSize" class="setting-input" value="100" min="1"
                                        max="1000" onchange="updateSetting('maxFileSize', this.value)">
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Auto-Delete Files</strong>
                                        <p>Automatically delete files after (hours, 0 = never)</p>
                                    </div>
                                    <input type="number" id="autoDeleteHours" class="setting-input" value="0" min="0"
                                        max="168" onchange="updateSetting('autoDeleteHours', this.value)">
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Session Timeout</strong>
                                        <p>Disconnect inactive clients after (minutes)</p>
                                    </div>
                                    <input type="number" id="sessionTimeout" class="setting-input" value="5" min="1"
                                        max="60" onchange="updateSetting('sessionTimeout', this.value)">
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>üîî Notifications</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Sound Notifications</strong>
                                        <p>Play sound when files are received</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="soundNotifications" checked
                                            onchange="toggleSetting('soundNotifications', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Desktop Notifications</strong>
                                        <p>Show desktop notifications for new files</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="desktopNotifications"
                                            onchange="toggleSetting('desktopNotifications', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>üõ°Ô∏è Security</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Blocked IP Addresses</strong>
                                        <p>Manage devices that are blocked from connecting</p>
                                    </div>
                                    <div class="blocked-ips-container">
                                        <div class="manual-block-input">
                                            <input type="text" id="manualBlockIP" placeholder="Enter IP to block..."
                                                class="setting-input-wide">
                                            <button class="btn btn-sm" onclick="addManualBlock()">Block</button>
                                        </div>
                                        <ul id="blockedIPsList" class="blocked-list">
                                            <!-- Blocked IPs will appear here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Shop Details Tab -->
                        <div id="shopTab" class="settings-tab-content">
                            <div class="settings-section">
                                <h4>üè™ Shop Information</h4>
                                <div class="form-group">
                                    <label>Shop Name</label>
                                    <input type="text" id="settingsShopName" placeholder="e.g., Quick Print Services" />
                                </div>
                                <div class="form-group">
                                    <label>Location (Optional)</label>
                                    <input type="text" id="settingsLocation"
                                        placeholder="e.g., Main Street, Downtown" />
                                </div>
                                <button class="btn btn-primary" onclick="saveShopDetails()">Save Changes</button>
                            </div>
                        </div>

                        <!-- Features Tab -->
                        <div id="featuresTab" class="settings-tab-content">
                            <div class="settings-section">
                                <h4>üåê Web Client</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Enable Web Client</strong>
                                        <p>Allow customers to upload files via web browser</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableWebClient" checked
                                            onchange="toggleSetting('webClient', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>‚òÅÔ∏è Public Access (Beta)</h4>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enablePublicAccess"
                                        onchange="toggleSetting('publicAccess', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <strong>Professional Access</strong>
                                    <p>Use your own domain (e.g., shop.yourdomain.com)</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="useCustomDomain"
                                        onchange="toggleSetting('useCustomDomain', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div id="customDomainSection" class="custom-domain-fields hidden">
                                <div class="form-group">
                                    <label>Cloudflare Tunnel Token</label>
                                    <input type="password" id="cloudflareToken" class="setting-input-wide"
                                        placeholder="Paste your Cloudflare Tunnel Token here"
                                        onchange="updateSetting('cloudflareToken', this.value)">
                                </div>
                                <div class="form-group">
                                    <label>Custom Hostname / Subdomain</label>
                                    <input type="text" id="customHostname" class="setting-input-wide"
                                        placeholder="e.g., print.myshop.com"
                                        onchange="updateSetting('customHostname', this.value)">
                                </div>
                                <p class="help-text-sm">Setup a "Cloudflare Tunnel" on your dashboard and paste the
                                    token here for a permanent URL.</p>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4>üì± Mobile App</h4>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <strong>Enable Mobile App Access</strong>
                                    <p>Allow mobile app connections (coming soon)</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enableMobileApp" checked disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="resetSettings()">Reset to Defaults</button>
                        <button class="btn btn-primary" onclick="closeSettings()">Done</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-stats">
                <div class="stat">
                    <span class="stat-value" id="totalFiles">0</span>
                    <span class="stat-label">Total Files</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="totalSize">0 MB</span>
                    <span class="stat-label">Total Size</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="todayFiles">0</span>
                    <span class="stat-label">Today</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Update Notification -->
    <div id="updateNotification" class="notification hidden">
        <p id="updateMessage">Checking for updates...</p>
        <button id="restartButton" class="hidden" onclick="restartApp()">Restart to Update</button>
        <button class="close-btn" onclick="closeUpdateNotification()">‚úï</button>
    </div>

    <script src="renderer.js"></script>
</body>

</html>